<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="技术闲谈" />
<meta name="keywords" content="rust, tauri, dart, flutter, go, python, javascript, typescript, web3" />
<link rel="icon" href="/images/favicon.ico">

<title>艾伦的空间 | Rust异步网络IO</title>
<meta property="og:title" content="艾伦的空间 | Rust异步网络IO" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/posts/rust-async-io/" />
<meta property="og:description" content="Rust异步网络IO" />
<meta property="og:image" content="" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Rust异步网络IO" />
<meta name="twitter:description" content="Rust异步网络IO" />
<meta property="twitter:image" content="" />


    <link rel="alternate" type="application/rss+xml" title="艾伦的空间" href="/atom.xml">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js"
        integrity="sha512-7x3zila4t2qNycrtZ31HO0NnJr8kg2VI67YLoRSyi9hGhRN66FHYWr7Axa9Y1J9tGYHVBPqIjSE1ogHrJTz51g=="
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/css/base.css">
</head>

<body>
    <header>
        <a class="site-name" href="/">
          <h1>艾伦的空间</h1>
        </a>
        <div class="site-description">
            <p></p>
        </div>
        <nav>
            <div class="links">
                
                
                <a 
                    href="/ ">首页
                </a>
                
                
                <a 
                    href="/posts ">笔记
                </a>
                
                
                <a 
                    href="/contact ">联系
                </a>
                
            </div>
        </nav>
    </header>
    <article>

<section class="post">
    <div class="post-header">
        <div class="meta">
            <div class="date">
                <span class="day">03</span>
                <span class="rest">2022年01月</span>
            </div>
        </div>

        <div class="matter">
            <h1 class="title">Rust异步网络IO</h1>
        </div>
    </div>
    <article>
        <p>同步 I/O 模型可能是在给定时间内处理多个客户端的主要瓶颈，必须使用线程处理更多的客户端。为更好的方法来扩展，我们可以让套接字是非阻塞的，而不是应对套接字的阻塞性质。</p>
<p>对于非阻塞套接字，其上的任何读取、写入或者操作都会立刻返回，无论操作成功与否。没有客户端需要等待请求完成，而是稍后同志请求成功与否。与线程相比，异步 I/O 模型非常高效，但它增加了代码的复杂性。</p>
<p>在基于 UNIX 的平台上，套接字上的轮询机制是通过 poll 和 select 系统调用完成的。这些调用在所有 UNIX 操作系统上都是兼容的，除此之外，Linux 还支持 epoll API。在 poll 和 select 对每个请求的套接字运行 for 循环的情况下，epoll 通过运行时 <code>O(1)</code>来同志用户的套接字事件。</p>
<h2 id="rust-zhong-de-yi-bu-chou-xiang">Rust 中的异步抽象</h2>
<p>Rust 提供了第三方软件包形式的便捷抽象，用于处理异步 I/O。当处理非阻塞套接字和底层套接字轮询机制时，它为开发人员简化了大多数复杂状态机的处理。可供用户选择的两个底层抽象软件包是 <code>futures</code> 和 <code>mio</code>。</p>
<h3 id="mio">mio</h3>
<p>mio 提供了底层机制的高度抽象，他可以为大多数 IO 复用 API 提供跨平台、高效的接口。mio 是一款底层软件包，它提供了一种为 socket 事件设置反应器的便捷方法。它和标准库类型相似，例如 <code>TcpStream</code>类型，不过默认情况下它是非阻塞的。</p>
<h3 id="futures">futures</h3>
<p>mio 杂耍式的套接字轮询状态机用起来并不是很方便。为了提供可供应用程序开发人员使用的高级 AP，提供了 future 软件包。</p>
<p>futures 软件包提供了一个 <code>Future</code> 核心 trait，这是该软件包的核心组成部分。</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">pub trait </span><span>Future {
</span><span>    </span><span style="color:#65737e;">// Future将解析的值
</span><span>    </span><span style="color:#b48ead;">type </span><span>Item;
</span><span>
</span><span>    </span><span style="color:#65737e;">// 操作失败时的错误类型
</span><span>    </span><span style="color:#b48ead;">type </span><span>Error;
</span><span>
</span><span>    </span><span style="color:#65737e;">// poll 指定了应该如何完成future过程
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">poll</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>) -&gt; Poll&lt;</span><span style="color:#b48ead;">Self::</span><span>Item, </span><span style="color:#b48ead;">Self::</span><span>Error&gt;;
</span><span>}
</span></code></pre>
<p><code>Future</code> 值自身不能构建异步应用程序，你需要将某种反应器和事件循环来推进 future 完成。<code>poll</code> 函数指定了应该如何完成 future 过程。future 也可以由几件事情组合而成，从而一个接一个地链接起来。为了推进 future，我们需要一个反应器和事件循环实现，这是由 tokio 软件包提供。</p>
<h3 id="tokio">tokio</h3>
<p>tokio 整合了上述两种抽象，以及工作窃取调度程序、事件循环和计时器实现，它提供了一个运行时来驱动 future 完成。通过 tokio 框架，你可以生成多个 future 并让它们同时运行。</p>
<p>tokio 软件包在技术上是一种运行时，由一个线程池、事件循环，基于 mio 的 I/O 事件的反应器组成。</p>
<p>当 future 没有任何数据要解析，或者在 <code>TcpStream</code> 客户端读取正在等待到达套接字的数据时，它将返回 NoReady 状态。但是在执行此操作时，还需要向反应器注册感兴趣的内容，以便能够再次获知服务器的任何新数据。</p>
<p>当创建 future 时，无须执行任何其他操作。对于 future 定义的工作任务，必须提交给执行程序完成。在 tokio 中，任务是可以执行 future 的用户级线程。在 poll 方法的实现中，任务必须安排自己稍后执行轮询，以防相关工作停滞。为此，它必须将其任务处理程序传递给反应器线程。在 Linux 中，反应器是 mio 软件包。</p>
<h3 id="gou-jian-yi-bu-redis-fu-wu-qi">构建异步 Redis 服务器</h3>
<p>略</p>

    </article>
</section>
</article>
    <footer>
        <div class="footer-top">
            <div class="social">
                <ul>
                    <li>
                        <a href="https://github.com/gelove" title="Github">
                            <i data-feather="github"></i>
                        </a>
                    </li>
                    <!-- <li>
                        <a href="https://twitter.com/geloves" title="Twitter">
                            <i data-feather="twitter"></i>
                        </a>
                    </li> -->
                    <!-- <li>
                        <a href="https://www.linkedin.com/in/geloves" title="LinkedIn">
                            <i data-feather="linkedin"></i>
                        </a>
                    </li> -->
                    <li>
                        <a href="/atom.xml" title="艾伦的空间">
                            <i data-feather="rss"></i>
                        </a>
                    </li>
                </ul>
            </div>
            <div>
                Powered by <a target="_blank" href="https://getzola.org/">Zola</a> © 艾伦的空间 2024
            </div>
        </div>
        <div class="footer-bottom ">
            <img class="beian-logo" src="/images/beian.png" />
            <a href="https://beian.mps.gov.cn/#/query/webSearch?code=32090302000410" rel="noreferrer" target="_blank">苏公网安备32090302000410</a>
            &nbsp; &nbsp; | &nbsp;&nbsp;
            <a href="https://beian.miit.gov.cn/" target="_blank">苏ICP备2023037751号</a>
        </div>
    </footer>
    <script>
        feather.replace();
    </script>
</body>

</html>
